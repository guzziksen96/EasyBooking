@{
    ViewBag.Title = "Home Page";
}

<script src="~/Scripts/bootstrap-datepicker.js"></script>
<link href="~/Content/bootstrap-datepicker.css" rel="stylesheet" />

<script src="~/Scripts/typeahead.bundle.js"></script>

<div class="jumbotron">
    <div class="landing-page">
        <div class="container-fluid">
            <div class="container" style="margin-top: 60px;">
                <div id="CityName" class="col-md-4 well">
                    <input type="text" name="text" id="text" placeholder="From?" class="text typeahead" />
                </div>
         
                <div id="CityName" class="col-md-4 well" style="margin-left:30px">
                    <input type="text" name="text" id="text" placeholder="To?" class="text typeahead"/>
                </div>
            </div>
            <div class="dates">
                <div>
                    @Html.TextBox("fromDate", "Depart", new { @class = "datepicker" })
                </div>
                <div>
                    @Html.TextBox("returnDate", "Return", new { @class = "datepicker" })
                </div>
            </div>
           
            @*<div>
            <div id="details"></div>
            <input type="text" id="Search" data-provide="typeahead" placeholder="Client Name" autocomplete="off" />
        </div>*@

        </div>
       
       
        
    </div>

    <div style="position:relative;">
        <!-- stuff -->
        <p style="position:absolute; bottom:0; right:20px;">
            <i class="fa fa-search" style="color:white; font-size:20px"></i>
        </p>
    </div>
</div>

<script>

    $('.datepicker').datepicker({
        format: 'dd/mm/yyyy',
        language: "EN",
        orientation: 'left bottom',
        autoclose: true
    });
    
    $(document).ready(function () {

        $("#Search").typeahead({
            source: function (query, process) {
                var countries = [];
                map = {};

                // This is going to make an HTTP post request to the controller
                return $.post('/Reservations/CountryLookup', { query: query }, function (data) {

                    // Loop through and push to the array
                    $.each(data, function (i, country) {
                        map[country.Name] = country;
                        countries.push(country.Name);
                    });

                    // Process the details
                    process(countries);
                });
            },
            updater: function (item) {
                var selectedShortCode = map[item].ShortCode;

                // Set the text to our selected id
                $("#details").text("Selected : " + selectedShortCode);
                return item;
            }
        });


        $(function () {
            var bestPictures = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('Value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: '/Reservations/testdata?query=%QUERY',

            });

            bestPictures.initialize();

            $('#remote .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'Value',
                minLength: 3,
                source: bestPictures.ttAdapter()
            });

            $('#remote .typeahead').on('typeahead:selected', function (event, suggestion, datasetName) {
                console.log(suggestion);
            });
        });

        $("#fromDate").on("change", function () {
            var fromDate = $('#fromDate').datepicker('getDate').toISOString();

            $.ajax({
                url: "/Reservations/ GetFromDateTime",
                type: "get",
                data: { fromDate: fromDate },
                complete: function (data) {
                },
                error: function () {
                },
                success: function () {
                }
            });
        });

        $("#returnDate").on("change", function () {
            var returnDate = $('#returnDate').datepicker('getDate').toISOString();

            $.ajax({
                url: "/Reservations/ GetReturnDateTime",
                type: "get",
                data: {
                    returnDate: returnDate
                },
                complete: function (data) {
                },
                error: function () {
                },
                success: function () {
                }
            });
        });
    });
    
</script>